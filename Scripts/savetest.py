from sklearn import datasets
from sklearn.neighbors import KNeighborsClassifier
import joblib
import os 

# 사이킷런에서 붓꽃 품종 데이터 세트를 가져옵니다.
dataset = datasets.load_iris()

# 입력 데이터와 타깃을 준비합니다.
X, y = dataset['data'], dataset['target']

# K 최근접 이웃 모델 객체를 만듭니다.
model = KNeighborsClassifier(n_neighbors=5)

# K 최근접 이웃 모델에 입력 데이터와 타깃을 입력하고 학습시킵니다.
model.fit(X, y)

# 학습시킨 모델을 현재 경로에 knn_model.pkl 파일로 저장합니다.
# Use the loaded pickled model to make predictions
models_dir = os.path.join(os.getcwd(), 'models')
joblib.dump(model, os.path.join(models_dir, 'testsave.pkl'))

# 저장한 모델을 불러와 변수에 담습니다.
loaded_model = joblib.load(os.path.join(models_dir, 'testsave.pkl'))

# 모델의 정확도를 계산하고 출력합니다.
score = loaded_model.score(X, y)
print('정확도: {score:.3f}'.format(score=score))